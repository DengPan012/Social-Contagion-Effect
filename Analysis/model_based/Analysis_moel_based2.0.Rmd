---
title: "Data Analysis of Social Contagion Effect"
output:
  html_document:
    df_print: paged
  html_notebook: default
  pdf_document: default
  word_document: default
editor_options:
  chunk_output_type: inline
---


## Loading

```{r}
rm(list = ls())
library(ggplot2);library(ggsignif);library(plyr);library(ggsignif);library(ggcorrplot);library(cowplot);library(psych);library(lme4);library(lmerTest);library(MASS);library(cocor);library(moments);library(rela);library(factoextra);library(dplyr);library(tidyr);library(car);library(afex);library(corrplot)

setwd("F:/Lusha Lab/writing up/model_based")
Data=read.csv("F:/Lusha Lab/writing up/model_based/All_Data_model_based.csv")
Data_pre=read.csv("F:/Lusha Lab/writing up/model_based/All_Data_predict.csv")
Data_free=read.csv("F:/Lusha Lab/writing up/model_based/All_Data_model_free.csv")
LogiP=read.csv("F:/Lusha Lab/writing up/model_based/LogiP.csv")
questionaire=read.csv("F:/Lusha Lab/writing up/model_based/question.csv")
```

# Prediction
```{r}
Data_pre$correct=(Data_pre$ChooseGamble==Data_pre$Choice)*1
df=Data_pre
mean=aggregate(df$correct,by=list(df$id,df$session,df$seq),FUN=mean)
sd=aggregate(df$correct,by=list(df$id,df$session,df$seq),FUN=sd) 
N=aggregate(df$correct,by=list(df$id,df$session,df$seq),FUN=length)
df2=data.frame(mean,sd=sd$x,N=N$x) 
colnames(df2)=c("id","session","seq","correct","sd","N")
df2$se = df2$sd / sqrt(df2$N) 

ggplot()+
  geom_line(data=df2,aes(x=seq,y=correct,color=factor(session)),size=2)+
  scale_y_continuous(breaks=c(0,0.5,1),labels=c("0%","50%","100%"))+
  scale_x_continuous(breaks=c(0,1,2),labels=c("start","middle","end"))+
  theme(axis.text.x=element_text(angle=45, vjust=1, size=10, hjust=1))+
  facet_wrap(~id, nrow=6, ncol = 8, scales = "fixed")

```

# exclude subjects
```{r}
Data$First_distance=Data$Observee2-Data$Session_1
Data$Second_distance=Data$Observee4-Data$Session_3
Data$Averse_distance=Data$First_distance
Data$Seeking_distance=Data$First_distance

Data$Averse_distance[!(Data$id%%2)]=Data$Second_distance[!Data$id%%2]
Data$Seeking_distance[!(!(Data$id%%2))]=Data$Second_distance[!(!(Data$id%%2))]
Data$Averse_distance=-Data$Averse_distance

Data=Data %>% unite("code",Domain,id,sep="_",remove=FALSE)
Data$Domain[Data$Domain==1]="Gain"
Data$Domain[Data$Domain==2]="Loss"
oldData=Data
exclude=c("1_16","1_7","2_12","2_10","2_14")
Data=Data[!(Data$code %in% exclude),]

```




#Initial risk-preference
```{r}
Start1<-sort(Data$Session_1[Data$Domain=="Gain"]);Start2<-sort(Data$Session_1[Data$Domain=="Loss"])

theme<-theme(axis.line.x = element_line(size=1),axis.line.y = element_line(size=1),
             axis.ticks.x = element_line(size=1),axis.ticks.y = element_line(size=1),
             axis.text.x=element_text(colour="black",size=24),
             axis.text.y=element_text(size=24,face="plain",colour="black"), 
             legend.title = element_text(size=24),
             legend.text = element_text(size=24),
             axis.title.y=element_text(size = 24,face="plain"), 
             axis.title.x=element_text(size = 24,face="plain"),
             panel.border = element_blank(),axis.line = element_line(colour = "black",size=1), 
             panel.grid.major = element_blank(),   
             panel.grid.minor = element_blank())

```
# Example Subject
```{r}
sub=Data[Data$code=="2_18",]
s1=sub$Session_1
s2=sub$Session_2
s3=sub$Session_3
s4=sub$Session_4
plotx=c(1,2,3,4)
ploty=c(s1,s2,s3,s4)
exa=data.frame(plotx,ploty)
ob2=sub$Observee2
ob4=sub$Observee4
plotx2=c(2,4)
ploty2=c(ob2,ob4)
obs=data.frame(plotx2,ploty2)
fig1a=ggplot() + 
  geom_point(data = obs, aes(x = plotx2, y = ploty2),size = 7,color="#0099FF") +
  geom_point(data = exa, aes(x = plotx, y = ploty),size = 7,color="#FF9933") + 
  geom_line(data = exa, aes(x = plotx, y = ploty),size = 3,color="#FF9933") + 
  theme_bw()+ 
  xlim(c(0.5,4.5))+
  guides(fill=F)+
  theme+ 
  ylab("Risk-preference")+xlab("Session")+ylim(c(-0.45,0.45))

```
```{r}
Obs_averse=mean(Data$Obs_averse)
Obs_seeking=mean(Data$Obs_seeking)


gainLen=length(Data$Domain[Data$Domain=="Gain"])
lossLen=length(Data$Domain[Data$Domain=="Loss"])
Domain <- c(rep(c("Gain"),each=gainLen),rep(c("Loss"),each=lossLen)) 
D0<-Data
D0$Domain <- factor(Domain) 
D<- D0[c('Domain','Session_1')] 

fig1b=ggplot(D, aes(x= Domain,y=Session_1,fill=Domain)) + 
  geom_hline(yintercept=c(Obs_averse,0,Obs_seeking), color=c("#0099FF",'gray',"#0099FF"), size=1.5)+
  geom_violin(trim=F,colour="white",alpha=0.5)+
  scale_fill_manual(values=c("gray","gray"))+
  geom_dotplot(binaxis='y', stackdir='center',width = 3,dotsize=1,color="#FF9933",fill="#FF9933")+
  geom_signif(y_position=c(0.4), xmin=c(1), xmax=c(2), annotation=c("*"), tip_length=0, size=0.6, textsize = 12,vjust = 0)+
  theme_bw()+ 
  guides(fill=F)+
  theme+ 
  ylab("Risk-preference")+xlab("Decision Frame")+ylim(c(-0.45,0.45))

```
```{r}
fig1=plot_grid(fig1a, NULL,fig1b, nrow = 1, rel_widths = c(1, 0.2, 1))
jpeg(file = "Fig1.jpg",width =3200,height = 1600,units = "px",res =300)
fig1
dev.off()
fig1
```
```{r}
risk_model=c(Data_model$Session1,Data_model$Session_2,Data_model$Session_3,Data_model$Session_4)
risk_free=c(Data_free$Session1,Data_free$Session_2,Data_free$Session_3,Data_free$Session_4)

fig0=ggplot(data=NULL, aes(x=risk_model,y=risk_free))+ 
  geom_point(size=5,alpha=0.5,color="black")+
  geom_smooth(method=lm,se=F,size=1.3,alpha=1,color="blue")+
  theme_bw()+ ylab("Model-free risk-preference")+xlab("Model-based risk-preference")+ylim(c(-0.45,0.45))+theme

jpeg(file = "Fig0_free_vs_base.jpg",width =1600,height = 1600,units = "px",res =300)
fig0
dev.off()
fig0
```
```{r}
shapiro.test(Start1)
shapiro.test(Start2)
t.test(Start1,Start2,paired = FALSE)
t.test(Start1,paired = FALSE)
t.test(Start2,paired = FALSE)

```
```{r}
data_averse=Data[,c("Domain","id","Averse_contagion","Averse_distance")]
colnames(data_averse)=c("Domain","id","contagion","distance")
data_averse$Risk=rep("Averse",length(data_averse$id))
data_seeking=Data[,c("Domain","id","Seeking_contagion","Seeking_distance")]
colnames(data_seeking)=c("Domain","id","contagion","distance")
data_seeking$Risk=rep("Seeking",length(data_seeking$id))

NewData=rbind(data_averse,data_seeking)
```

```{r}
LossCon=NewData$contagion[NewData$Domain=="Gain"]
GainCon=NewData$contagion[NewData$Domain=="Loss"]

t.test(LossCon,paired = FALSE)
t.test(GainCon,paired = FALSE)
t.test(LossCon,GainCon,paired = FALSE)
```
```{r}
mean<-c(mean(GainCon),mean(LossCon)) 
se<-c(sd(GainCon)/sqrt(length(GainCon)),sd(LossCon)/sqrt(length(LossCon))) 
data0<-data.frame(c("Gain","Loss"),mean,se) 
colnames(data0)=c("Domain","Contagion","se")

WORD_SIZE = 15
fig2a=ggplot(data0, aes(x=Domain,y=Contagion,fill=Domain))+
  geom_bar(position=position_dodge(), color="white",stat="identity",width=0.9,size=1)+
  scale_fill_manual(values=c("#77CCEE", "#77CCEE"))+
  geom_errorbar(aes(ymin=Contagion-se,ymax=Contagion+se),width=0.1, position=position_dodge(0.9),size=1,color="black")+
  geom_signif(y_position=c(0.15),xmin=c(1),xmax=c(1),annotation=c("***"),tip_length=0,size=0.6,textsize=10,vjust=0.5)+
  geom_signif(y_position=c(0.15),xmin=c(2),xmax=c(2),annotation=c("***"),tip_length=0,size=0.6,textsize=10,vjust=0.5)+
  geom_signif(y_position=c(0.17),xmin=c(1),xmax=c(2),annotation=c("n.s."),tip_length=0,size=0.6,textsize=7,vjust=0)+
  labs(x="Decision Frame", y="Contagion Effect")+
  theme_bw()+
  #geom_jitter(data=NewData,aes(x=factor(Domain),y=contagion,fill=factor(Domain)),position=position_jitter(0.4),alpha=0.5)+
  guides(fill=F)+
  theme+ylim(c(-0,0.2))
```

# Risk-preference
```{r}
AverCon=Data$Averse_contagion
SeekCon=Data$Seeking_contagion

t.test(AverCon,paired = FALSE)
t.test(SeekCon,paired = FALSE)
t.test(AverCon,SeekCon,paired = TRUE)
```

```{r}
mean<-c(mean(AverCon),mean(SeekCon)) 

sd<-c(sd(AverCon),sd(SeekCon)) 
se<-c(sd(AverCon)/sqrt(length(AverCon)),sd(SeekCon)/sqrt(length(SeekCon))) 
data0<-data.frame(c("Averse","Seeking"),mean,sd,se) 
colnames(data0)=c("Risk","Contagion","sd","se")

WORD_SIZE = 15
fig2b=ggplot(data0, aes(x=factor(Risk),y=Contagion,fill=factor(Risk)))+
  geom_bar(position=position_dodge(), color="white",stat="identity",width=0.9,size=1)+
  scale_fill_manual(values=c("#22DFA9", "#DF22A9"))+
  geom_errorbar(aes(ymin=Contagion-se,ymax=Contagion+se),width=0.1, position=position_dodge(0.9),size=1,color="black")+
  geom_signif(y_position=c(0.15),xmin=c(1),xmax=c(1),annotation=c("***"),tip_length=0,size=0.6,textsize=10,vjust=0.5)+
  geom_signif(y_position=c(0.15),xmin=c(2),xmax=c(2),annotation=c("***"),tip_length=0,size=0.6,textsize=10,vjust=0.5)+
  geom_signif(y_position=c(0.17),xmin=c(1),xmax=c(2),annotation=c("**"),tip_length=0,size=0.6,textsize=10,vjust=0.5)+
  labs(x="Observee's Risk-preference", y="Contagion Effect")+
  theme_bw()+
  guides(fill=F)+
  theme+ylim(c(-0,0.2))
  #geom_jitter(data=NewData,aes(x=factor(Risk),y=contagion,fill=factor(Risk)),position=position_jitter(0.4),alpha=0.5)
  

fig2=plot_grid(fig2b, NULL,fig2a, nrow = 1, rel_widths = c(1, 0.2, 1))

jpeg(file = "Fig2_Allcontagion.jpg",width =3200,height = 1600,units = "px",res =300) 
fig2
dev.off()
fig2

```
# Interaction of contagion
```{r}
lm1=lm(contagion~Domain*Risk,data=NewData)
summary(lm1)

summary(aov(contagion~Domain*Risk+Error(id/Risk),data=NewData))
```
```{r}
t.test(Data$Seeking_contagion[Data$Domain=="Gain"],Data$Averse_contagion[Data$Domain=="Gain"],paired = TRUE)
t.test(Data$Seeking_contagion[Data$Domain=="Loss"],Data$Averse_contagion[Data$Domain=="Loss"],paired = TRUE)

t.test(Data$Averse_contagion[Data$Domain=="Gain"],Data$Averse_contagion[Data$Domain=="Loss"],paired = FALSE)
t.test(Data$Seeking_contagion[Data$Domain=="Gain"],Data$Seeking_contagion[Data$Domain=="Loss"],paired = FALSE)

```

```{r}
df=NewData
mean=aggregate(df$contagion,by=list(df$Domain,df$Risk),FUN=mean)
sd=aggregate(df$contagion,by=list(df$Domain,df$Risk),FUN=sd) 
N=aggregate(df$contagion,by=list(df$Domain,df$Risk),FUN=length)
data2=data.frame(mean,sd=sd$x,N=N$x) 
colnames(data2)=c("Domain","Risk","contagion","sd","N")
data2$se = data2$sd / sqrt(data2$N) 

fig3=ggplot(data2, aes(x=Domain,y=contagion,fill=Risk))+
  geom_bar(position=position_dodge(), color="white",stat="identity",width=0.9,size=1)+
  geom_errorbar(aes(ymin=contagion-se,ymax=contagion+se),width=0.2, size=1,position=position_dodge(0.9))+
  scale_fill_manual(values=c("#22DFA9", "#DF22A9"))+
  geom_signif(y_position=c(0.19),xmin=c(1.775),xmax=c(2.225),annotation=c("**"),tip_length=0.05, size=0.6, textsize=10,vjust=0.5)+
  geom_signif(y_position=c(0.19),xmin=c(0.775),xmax=c(1.225),annotation=c("n.s."),tip_length=0.05, size=0.6, textsize=7,vjust=0)+
  
  labs(x="Decision Frame", y="Contagion Effect", fill="Observee's 
Risk-preference")+
  theme_bw()+
  theme

jpeg(file = "Fig3_InterContagion.jpg",width =3200,height = 1600,units = "px",res =300) 
fig3
dev.off()
fig3
```

```{r}
len_id=length(Data$id)
code=rep(Data$code,2)
id=rep(Data$id,2)
Domain=rep(Data$Domain,2)
Data$SeekingFirst=1*(Data$Seeking_contagion==Data$First_contagion)
Risk=c(Data$SeekingFirst,1-Data$SeekingFirst)
pretest=c(Data$Session_1,Data$Session_3)
posttest=c(Data$Session_2,Data$Session_4)
IndData=data.frame(code,id,Domain,Risk,pretest,posttest)
IndData$Risk[IndData$Risk==1]="Seeking"
IndData$Risk[IndData$Risk==0]="Averse"

NewIndData=rbind(IndData,IndData)
NewIndData$session=sort(rep(c("initial","observed"),len_id*2))
NewIndData$pretest[NewIndData$session=="observed"]=NewIndData$posttest
NewIndData$preference=NewIndData$pretest
NewIndData$pretest=c()
NewIndData$posttest=c()
```
```{r}

sup3=ggplot()+
  geom_line(data=NewIndData,aes(x=session,y=preference,group=code,color=Risk),alpha=0.3,size=1)+
  facet_wrap(Domain~Risk, nrow=2, ncol = 2, scales = "fixed")+
  scale_color_manual(values=c("#22DFA9", "#DF22A9"))+
  theme_bw()#+ theme

sup3
df<-NewIndData
means<-aggregate(df$preference,by=list(df$Domain,df$Risk,df$session),FUN=median) 
sd<-aggregate(df$preference,by=list(df$Domain,df$Risk,df$session),FUN=sd) 
N<-aggregate(df$preference,by=list(df$Domain,df$Risk,df$session),FUN=length)
data1<-data.frame(means,sd=sd$x,N=N$x) 
colnames(data1)=c("Domain","Risk","session","mean","sd","N")
data1$se <- data1$sd / sqrt(data1$N)
sup3=sup3+geom_point(data=data1,aes(x=session,y=mean),size=2)+
  geom_errorbar(data=data1,aes(session,ymin=mean-sd,ymax=mean+sd),width=0,size=1)+
  theme(axis.text.x=element_text(angle=45,size=10, vjust=1, hjust=1))+
  labs(color="Observee's 
Risk-preference", y="Risk-preference")+
  facet_wrap(Domain~Risk, nrow=2, ncol = 2, scales = "fixed")
  
  

jpeg(file = "Sup3_IndividualContagion.jpg",width =1600,height = 1200,units = "px",res =300) 
sup3
dev.off()
sup3


```
```{r}
lm1=lm(distance~Domain*Risk,data=NewData)
summary(lm1)

summary(aov(distance~Domain*Risk+Error(id/Risk),data=NewData))
```
```{r}
dis_Loss_Averse=NewData$distance[NewData$Domain=="Loss" & NewData$Risk=="Averse"]
dis_Loss_Seeking=NewData$distance[NewData$Domain=="Loss" & NewData$Risk=="Seeking"]
dis_Gain_Averse=NewData$distance[NewData$Domain=="Gain" & NewData$Risk=="Averse"]
dis_Gain_Seeking=NewData$distance[NewData$Domain=="Gain" & NewData$Risk=="Seeking"]

t.test(dis_Gain_Seeking,dis_Loss_Seeking,paired = FALSE)
t.test(dis_Gain_Averse,dis_Loss_Averse,paired = FALSE)
t.test(dis_Gain_Averse,dis_Gain_Seeking,paired = TRUE)
t.test(dis_Loss_Averse,dis_Loss_Seeking,paired = TRUE)
```

```{r}
df=NewData
mean=aggregate(df$distance,by=list(df$Domain,df$Risk),FUN=mean)
sd=aggregate(df$distance,by=list(df$Domain,df$Risk),FUN=sd) 
N=aggregate(df$distance,by=list(df$Domain,df$Risk),FUN=length)
data2=data.frame(mean,sd=sd$x,N=N$x) 
colnames(data2)=c("Domain","Risk","distance","sd","N")
data2$se = data2$sd / sqrt(data2$N) 

fig4=ggplot(data2, aes(x=Domain,y=distance,fill=Risk))+
  geom_bar(position=position_dodge(), color="white",stat="identity",width=0.9,size=1)+
  geom_errorbar(aes(ymin=distance-se,ymax=distance+se),width=0.2, size=1,position=position_dodge(0.9))+
  scale_fill_manual(values=c("#22DFA9", "#DF22A9"))+
  geom_signif(y_position=c(0.5), xmin=c(1.775), xmax=c(2.225), annotation=c("n.s."), tip_length=0.05, size=0.6, textsize = 7,vjust = 0)+
  geom_signif(y_position=c(0.5), xmin=c(0.775), xmax=c(1.225),annotation=c("***"), tip_length=0.05, size=0.6, textsize = 10,vjust = 0.5)+
  labs(x="Decision Frame", y="Risk-preference Distance", fill="Observee's
Risk-preference")+
  theme_bw()+
  theme

jpeg(file = "Fig4_InterDistance.jpg",width =3200,height = 1600,units = "px",res =300) 
fig4
dev.off()
fig4
```
```{r}
NewData$contagion_ratio=NewData$contagion/NewData$distance
df=NewData
ratio_Loss_Averse=df$contagion_ratio[df$Domain=="Loss" & df$Risk=="Averse"]
ratio_Loss_Seeking=df$contagion_ratio[df$Domain=="Loss" & df$Risk=="Seeking"]
ratio_Gain_Averse=df$contagion_ratio[df$Domain=="Gain" & df$Risk=="Averse"]
ratio_Gain_Seeking=df$contagion_ratio[df$Domain=="Gain" & df$Risk=="Seeking"]

t.test(ratio_Gain_Seeking,ratio_Loss_Seeking,paired = FALSE)
t.test(ratio_Gain_Averse,ratio_Loss_Averse,paired = FALSE)
t.test(ratio_Gain_Averse,ratio_Gain_Seeking,paired = TRUE)
t.test(ratio_Loss_Averse,ratio_Loss_Seeking,paired = TRUE)
```
```{r}

mean=aggregate(df$contagion_ratio,by=list(df$Domain,df$Risk),FUN=mean)
sd=aggregate(df$contagion_ratio,by=list(df$Domain,df$Risk),FUN=sd) 
N=aggregate(df$contagion_ratio,by=list(df$Domain,df$Risk),FUN=length)
data2=data.frame(mean,sd=sd$x,N=N$x) 
colnames(data2)=c("Domain","Risk","contagion_ratio","sd","N")
data2$se = data2$sd / sqrt(data2$N) 

fig5=ggplot(data2, aes(x=Domain,y=contagion_ratio,fill=Risk))+
  geom_bar(position=position_dodge(), color="white",stat="identity",width=0.9,size=1)+
  geom_errorbar(aes(ymin=contagion_ratio-se,ymax=contagion_ratio+se),width=0.2, size=1,position=position_dodge(0.9))+
  scale_fill_manual(values=c("#22DFA9", "#DF22A9"))+
  geom_signif(y_position=c(0.73), xmin=c(1.775), xmax=c(2.225), annotation=c("**"), tip_length=0.05, size=0.6, textsize = 10,vjust = 0.5)+
  geom_signif(y_position=c(0.73), xmin=c(0.775), xmax=c(1.225),annotation=c("*"), tip_length=0.05, size=0.6, textsize = 10,vjust = 0.5)+
  labs(x="Decision Frame", y="Contagion Ratio", fill="Observee's 
Risk-preference")+
  theme_bw()+
  theme

jpeg(file = "Fig5_InterContagion_ratio.jpg",width =3200,height = 1600,units = "px",res =300) 
fig5
dev.off()
fig5
```
```{r}
NewData$contagion_ratio=NewData$contagion/NewData$distance
df=NewData
ratio_Averse=df$contagion_ratio[df$Risk=="Averse"]
ratio_Seeking=df$contagion_ratio[df$Risk=="Seeking"]
t.test(ratio_Averse,ratio_Seeking,paired = FALSE)
```
```{r}

mean=aggregate(df$contagion_ratio,by=list(df$Risk),FUN=mean)
sd=aggregate(df$contagion_ratio,by=list(df$Risk),FUN=sd) 
N=aggregate(df$contagion_ratio,by=list(df$Risk),FUN=length)
data3=data.frame(mean,sd=sd$x,N=N$x) 
colnames(data3)=c("Risk","contagion_ratio","sd","N")
data3$se = data3$sd / sqrt(data3$N) 

WORD_SIZE = 15
fig6a=ggplot(data3, aes(x=Risk,y=contagion_ratio,fill=Risk))+
  geom_bar(position=position_dodge(), color="white",stat="identity",width=0.9,size=1)+
  geom_errorbar(aes(ymin=contagion_ratio-se,ymax=contagion_ratio+se),width=0.2, size=1,position=position_dodge(0.9),color="black")+
  scale_fill_manual(values=c("#22DFA9", "#DF22A9"))+
  labs(x="Observee's Risk-preference", y="Contagion Ratio")+
  geom_signif(y_position=c(0.7), xmin=c(1), xmax=c(2),annotation=c("***"), tip_length=0.05, size=0.6, textsize =10,vjust = 0.5)+
  theme_bw()+
  guides(fill=F)+
  theme


```
```{r}
summary(lm(contagion~distance+Risk+distance*Risk, data=NewData))

summary(lm(contagion~distance*Risk*Domain, data=NewData))


summary(lm(contagion~distance, data=NewData[NewData$Risk=="Averse",]))

summary(lm(contagion~distance, data=NewData[NewData$Risk=="Seeking",]))

```
```{r}
summary(lm(contagion~distance, data=NewData))

```


```{r}
pointdata=df
fig6b=ggplot(pointdata, aes(x=distance, y=contagion, color=Risk)) + 
  geom_point(size=5,alpha=0.5)+
  scale_color_manual(values=c("#22DFA9","#DF22A9"))+
  geom_smooth(method=lm,se=F,size=1.3,alpha=1)+
  labs(y="Contagion Effect", x="Risk-preference Distance", color="Observee's
Risk-preference")+
  theme_bw()+
  guides(color=F)+
  theme 

```
```{r}
fig6=plot_grid(fig6a, NULL,fig6b, nrow = 1, rel_widths = c(1, 0.2, 1))

jpeg(file = "Fig6_dis_con.jpg",width =3200,height = 1600,units = "px",res =300) #结果保存
fig6
dev.off()
fig6
```
```{r}

fig7=ggplot(df, aes(x=distance, y=contagion,shape=Domain,color=Risk)) + 
  geom_point(size=5,alpha=0.5)+
  scale_color_manual(values=c("#22DFA9","#DF22A9"))+
  geom_smooth(method=lm,se=F,size=1.3,alpha=1)+
  labs(y="Contagion Effect", x="Risk-preference Distance", color="Observee's 
Risk-preference",shape="Decision Frame")+
  theme_bw()+
  theme 
jpeg(file = "Fig7_Dis_con_all.jpg",width =3200,height = 1600,units = "px",res =300) #结果保存
fig7
dev.off()
fig7


```

```{r}

fig8a=ggplot(df, aes(x=distance, y=contagion)) + 
  geom_point(size=5,alpha=0.5)+
  geom_smooth(method=lm,se=F,size=1.3,alpha=1)+
  labs(y="Contagion Effect", x="Risk-preference Distance", color="Observee's 
Risk-preference",shape="Decision Frame")+
  theme_bw()+
  theme 

```

```{r}

fig8b=ggplot(df, aes(x=distance, y=contagion,shape=Domain)) + 
  geom_point(size=5,alpha=0.5)+
  geom_smooth(method=lm,se=F,size=1.3,alpha=1)+
  labs(y="Contagion Effect", x="Risk-preference Distance", color="Observee's 
Risk-preference",shape="Decision Frame")+
  theme_bw()+
  guides(shape=F)+
  theme 
```

```{r}
fig8=plot_grid(fig8a, NULL,fig8b, nrow = 1, rel_widths = c(1, 0.2, 1))
jpeg(file = "Fig8_dis_con_Domain.jpg",width =3200,height = 1600,units = "px",res =300) #结果保存
fig8
dev.off()
fig8
```

# regression to baseline
```{r}
e1<-aggregate(Data$Session_1,by=list(Data$Domain),FUN=mean)
e2<-aggregate(Data$Session_2,by=list(Data$Domain),FUN=mean)
e3<-aggregate(Data$Session_3,by=list(Data$Domain),FUN=mean)
e4<-aggregate(Data$Session_4,by=list(Data$Domain),FUN=mean)
sd1<-aggregate(Data$Session_1,by=list(Data$Domain),FUN=sd)
sd2<-aggregate(Data$Session_2,by=list(Data$Domain),FUN=sd)
sd3<-aggregate(Data$Session_3,by=list(Data$Domain),FUN=sd)
sd4<-aggregate(Data$Session_4,by=list(Data$Domain),FUN=sd)
N<-aggregate(Data$id,by=list(Data$Domain),FUN=length)
me=matrix(c(e1$x,e2$x,e3$x,e4$x),nr=2,nc=4)
sd=matrix(c(sd1$x,sd2$x,sd3$x,sd4$x),nr=2,nc=4)

M=c(me[1,c(1:4)],me[2,c(1:4)])
SD=c(sd[1,c(1:4)],sd[2,c(1:4)])
N=rep(c(20,21),each=4)
SE=SD/sqrt(N)
ses=rep(c(1:4),2)
domain=rep(c("Gain","Loss"),each=4)

D<-data.frame(ses,domain,M,SE) 

riskPreference=c(Data$Session_1,Data$Session_2,Data$Session_3,Data$Session_4)
ID=factor(rep(c(Data$id),4))
domain=factor(rep(c(Data$Domain),4))
session=factor(rep(c(1:4),each=length(Data$id)))
DDV=data.frame(ID,session,domain,riskPreference)

dis_aov<-aov(riskPreference ~ domain * session + Error(ID/session), data = DDV)
summary(dis_aov)
```

```{r}
fig9a<-ggplot(D, aes(x= ses,y=M,fill=factor(domain),color=domain)) + 
  geom_ribbon(aes(ymax = M+SE, ymin = M-SE,fill=factor(domain)),alpha=0.3,color=0,size=0)+
  geom_line(size=1.4,alpha=1) +
  scale_color_manual(values=c("red","blue"))+
  scale_fill_manual(values=c("#FF77CC", "#77CCFF"))+
  geom_signif(y_position=c(0.09), xmin=c(2), xmax=c(4),annotation=c("n.s."), tip_length=0, size=0.6, textsize = 7,vjust = 0,color="black")+
  theme_bw()+ 
  guides(fill=F)+
  labs(x="Session", y="Risk-preference",fill="Observee's risk")+
  theme+ theme(legend.position = c(0.8, 0.2))+
  ylim(c(0,0.2))

```
```{r}
Data_abs=Data

Data_abs$Session_1=abs(Data_abs$Session_1)
Data_abs$Session_2=abs(Data_abs$Session_2)
Data_abs$Session_3=abs(Data_abs$Session_3)
Data_abs$Session_4=abs(Data_abs$Session_4)

e1<-aggregate(Data_abs$Session_1,by=list(Data_abs$Domain),FUN=mean)
e2<-aggregate(Data_abs$Session_2,by=list(Data_abs$Domain),FUN=mean)
e3<-aggregate(Data_abs$Session_3,by=list(Data_abs$Domain),FUN=mean)
e4<-aggregate(Data_abs$Session_4,by=list(Data_abs$Domain),FUN=mean)
sd1<-aggregate(Data_abs$Session_1,by=list(Data_abs$Domain),FUN=sd)
sd2<-aggregate(Data_abs$Session_2,by=list(Data_abs$Domain),FUN=sd)
sd3<-aggregate(Data_abs$Session_3,by=list(Data_abs$Domain),FUN=sd)
sd4<-aggregate(Data_abs$Session_4,by=list(Data_abs$Domain),FUN=sd)
N<-aggregate(Data_abs$id,by=list(Data_abs$Domain),FUN=length)
me=matrix(c(e1$x,e2$x,e3$x,e4$x),nr=2,nc=4)
sd=matrix(c(sd1$x,sd2$x,sd3$x,sd4$x),nr=2,nc=4)

M=c(me[1,c(1:4)],me[2,c(1:4)])
SD=c(sd[1,c(1:4)],sd[2,c(1:4)])
N=rep(c(20,21),each=4)
SE=SD/sqrt(N)
ses=rep(c(1:4),2)
domain=rep(c("Gain","Loss"),each=4)

D<-data.frame(ses,domain,M,SE) 

riskPreference=c(Data_abs$Session_1,Data_abs$Session_2,Data_abs$Session_3,Data_abs$Session_4)
ID=factor(rep(c(Data_abs$id),4))
domain=factor(rep(c(Data_abs$Domain),4))
session=factor(rep(c(1:4),each=length(Data_abs$id)))
DDV=data.frame(ID,session,domain,riskPreference)

dis_aov<-aov(riskPreference ~ domain * session + Error(ID/session), data = DDV)
summary(dis_aov)
```
```{r}

fig9b<-ggplot(D, aes(x= ses,y=M,fill=factor(domain),color=domain)) + 
  geom_ribbon(aes(ymax = M+SE, ymin = M-SE,fill=factor(domain)),alpha=0.3,color=0,size=0)+
  geom_line(size=1.4,alpha=1) +
  scale_color_manual(values=c("red","blue"))+
  scale_fill_manual(values=c("#FF77CC", "#77CCFF"))+
  geom_signif(y_position=c(0.17), xmin=c(1), xmax=c(4),annotation=c("n.s."), tip_length=0, size=0.6, textsize = 7,vjust = 0,color="black")+
  theme_bw()+ 
  guides(fill=F)+
  labs(x="Session", y="Risk-preference",fill="Observee's risk")+
  theme+ theme(legend.position = c(0.8, 0.2))+
  ylim(c(0,0.2))
fig9b

```
```{r}
fig9=plot_grid(fig9b, NULL,fig9b, nrow = 1, rel_widths = c(1, 0.2, 1))

jpeg(file = "Fig9_RegressTo.jpg",width =3200,height = 1600,units = "px",res =300) #结果保存
fig9
dev.off()
fig9
```

```{r}
Data_base=Data
Session_1=c(rep(mean(Data_base$Session_1[Data_base$Domain=="Gain"]),length(Data$id[Data$Domain=="Gain"])),rep(mean(Data_base$Session_1[Data_base$Domain=="Loss"]),length(Data$id[Data$Domain=="Loss"])))
Data_base$Session_2=abs(Data_base$Session_2-Session_1)
Data_base$Session_3=abs(Data_base$Session_3-Session_1)
Data_base$Session_4=abs(Data_base$Session_4-Session_1)
Data_base$Session_1=abs(Data_base$Session_1-Session_1)

e1<-aggregate(Data_base$Session_1,by=list(Data_base$Domain),FUN=mean)
e2<-aggregate(Data_base$Session_2,by=list(Data_base$Domain),FUN=mean)
e3<-aggregate(Data_base$Session_3,by=list(Data_base$Domain),FUN=mean)
e4<-aggregate(Data_base$Session_4,by=list(Data_base$Domain),FUN=mean)
sd1<-aggregate(Data_base$Session_1,by=list(Data_base$Domain),FUN=sd)
sd2<-aggregate(Data_base$Session_2,by=list(Data_base$Domain),FUN=sd)
sd3<-aggregate(Data_base$Session_3,by=list(Data_base$Domain),FUN=sd)
sd4<-aggregate(Data_base$Session_4,by=list(Data_base$Domain),FUN=sd)
N<-aggregate(Data_base$id,by=list(Data_base$Domain),FUN=length)
me=matrix(c(e1$x,e2$x,e3$x,e4$x),nr=2,nc=4)
sd=matrix(c(sd1$x,sd2$x,sd3$x,sd4$x),nr=2,nc=4)

M=c(me[1,c(1:4)],me[2,c(1:4)])
SD=c(sd[1,c(1:4)],sd[2,c(1:4)])
N=rep(c(20,21),each=4)
SE=SD/sqrt(N)
ses=rep(c(1:4),2)
domain=rep(c("Gain","Loss"),each=4)

D<-data.frame(ses,domain,M,SE) 

riskPreference=c(Data_base$Session_1,Data_base$Session_2,Data_base$Session_3,Data_base$Session_4)
ID=factor(rep(c(Data_base$id),4))
domain=factor(rep(c(Data_base$Domain),4))
session=factor(rep(c(1:4),each=length(Data_base$id)))
DDV=data.frame(ID,session,domain,riskPreference)

dis_aov<-aov(riskPreference ~ domain * session + Error(ID/session), data = DDV)
summary(dis_aov)
```
```{r}
fig10a<-ggplot(D, aes(x= ses,y=M,fill=factor(domain),color=domain)) + 
  geom_ribbon(aes(ymax = M+SE, ymin = M-SE,fill=factor(domain)),alpha=0.3,color=0,size=0)+
  geom_line(size=1.4,alpha=1) +
  scale_color_manual(values=c("red","blue"))+
  scale_fill_manual(values=c("#FF77CC", "#77CCFF"))+
  geom_signif(y_position=c(0.17), xmin=c(1), xmax=c(4),annotation=c("n.s."), tip_length=0, size=0.6, textsize = 7,vjust = 0,color="black")+
  theme_bw()+ 
  guides(fill=F)+
  labs(x="Session", y="Risk-preference",fill="Observee's risk")+
  theme+ theme(legend.position = c(0.8, 0.2))+
  ylim(c(0,0.2))


```
```{r}

Data_base=Data
Session_1=Data_base$Session_1
Data_base$Session_2=abs(Data_base$Session_2-Session_1)
Data_base$Session_3=abs(Data_base$Session_3-Session_1)
Data_base$Session_4=abs(Data_base$Session_4-Session_1)
Data_base$Session_1=abs(Data_base$Session_1-Session_1)

e1<-aggregate(Data_base$Session_1,by=list(Data_base$Domain),FUN=mean)
e2<-aggregate(Data_base$Session_2,by=list(Data_base$Domain),FUN=mean)
e3<-aggregate(Data_base$Session_3,by=list(Data_base$Domain),FUN=mean)
e4<-aggregate(Data_base$Session_4,by=list(Data_base$Domain),FUN=mean)
sd1<-aggregate(Data_base$Session_1,by=list(Data_base$Domain),FUN=sd)
sd2<-aggregate(Data_base$Session_2,by=list(Data_base$Domain),FUN=sd)
sd3<-aggregate(Data_base$Session_3,by=list(Data_base$Domain),FUN=sd)
sd4<-aggregate(Data_base$Session_4,by=list(Data_base$Domain),FUN=sd)
N<-aggregate(Data_base$id,by=list(Data_base$Domain),FUN=length)
me=matrix(c(e1$x,e2$x,e3$x,e4$x),nr=2,nc=4)
sd=matrix(c(sd1$x,sd2$x,sd3$x,sd4$x),nr=2,nc=4)

M=c(me[1,c(1:4)],me[2,c(1:4)])
SD=c(sd[1,c(1:4)],sd[2,c(1:4)])
N=rep(c(20,21),each=4)
SE=SD/sqrt(N)
ses=rep(c(1:4),2)
domain=rep(c("Gain","Loss"),each=4)

D<-data.frame(ses,domain,M,SE) 

riskPreference=c(Data_base$Session_1,Data_base$Session_2,Data_base$Session_3,Data_base$Session_4)
ID=factor(rep(c(Data_base$id),4))
domain=factor(rep(c(Data_base$Domain),4))
session=factor(rep(c(1:4),each=length(Data_base$id)))
DDV=data.frame(ID,session,domain,riskPreference)

dis_aov<-aov(riskPreference ~ domain * session + Error(ID/session), data = DDV)
summary(dis_aov)
```
```{r}
fig10b<-ggplot(D, aes(x= ses,y=M,fill=factor(domain),color=domain)) + 
  geom_ribbon(aes(ymax = M+SE, ymin = M-SE,fill=factor(domain)),alpha=0.3,color=0,size=0)+
  geom_line(size=1.4,alpha=1) +
  scale_color_manual(values=c("red","blue"))+
  scale_fill_manual(values=c("#FF77CC", "#77CCFF"))+
  geom_signif(y_position=c(0.17), xmin=c(2), xmax=c(4),annotation=c("n.s."), tip_length=0, size=0.5, textsize = 7,vjust = 0,color="black")+
  theme_bw()+ 
  guides(fill=F)+
  labs(x="Session", y="Risk-preference",fill="Observee's risk")+
  theme+ theme(legend.position = c(0.8, 0.2))+
  ylim(c(0,0.2))


```
```{r}
fig10=plot_grid(fig10a, NULL,fig10b, nrow = 1, rel_widths = c(1, 0.2, 1))

jpeg(file = "Fig10_Baseline.jpg",width =3200,height = 1600,units = "px",res =300) #结果保存
fig10
dev.off()
fig10
```
